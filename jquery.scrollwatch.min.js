!function(a,b){"use strict";var c=["fixed","relative","absolute"],d="mousewheel resize",e=a(b),f=function(c,d){_.bindAll(this,"handleScroll","onScroll"),this.$el=a(c),this.el=this.$el[0],this.options=_.defaults(d||{},{watchOn:b}),this.$watchOn=a(this.options.watchOn),this._prepareContainer(),this.inViewport=!1,this.callbacks={scrollin:a.Callbacks(),scrollout:a.Callbacks(),scroll:a.Callbacks()},this.listen()};f.prototype={_prepareContainer:function(){if(this.$watchOn[0]!==b){var a=this.$watchOn.css("position"),d=_.contains(c,a);d||this.$watchOn.css("position","relative")}},listen:function(){this.$watchOn.on("scroll",this.onScroll),e.on(d,this.onScroll)},destroy:function(){this.$watchOn.off("scroll",this.onScroll),e.off(d,this.onScroll),this.$el.data("scrollWatch",null)},on:function(a,b,c,d){return _.isFunction(b)&&(d=c,c=b,b={}),b=_.extend({},this.options,b),c=_.bind(c,d||this.$el),b.delay&&(c=this._createDelayedCallback(a,c,b)),this.callbacks[a].add(c),this.$watchOn.scroll(),this},_createDelayedCallback:function(a,b,c){return function(){var a=arguments;_.delay(function(){b.apply(this,a)},c.delay)}},handleScroll:function(a){var b=this.visibility,c=this.surroundVisibility,d=this.isInViewport(!1),e=this.isInViewport(!0),f=this.$watchOn.scrollTop();return this.lastOffset===!1?this.direction=!1:this.direction=f>this.lastOffset?"down":"up",this.lastOffset=f,this.visibility=d,this.surroundVisibility=e,this.inViewport||1!==d?this.inViewport&&0===d&&(this.inViewport=!1,this.dfd?this.dfd.done(_.bind(this.trigger,this,"scrollout")):this.trigger("scrollout")):(this.inViewport=!0,this.trigger("scrollin")),(d!==b||e!==c||a)&&this.trigger("scroll"),this},onScroll:function(a){this.running||(this.running=!0,this.originalEvent=a,this.handleScroll(),this.running=!1)},trigger:function(a){return"scroll"!==a&&a===this.lastTriggered?!1:(this.lastTriggered=a,void this.callbacks[a].fire({direction:this.direction,visibility:this.visibility,surroundVisibility:this.surroundVisibility,originalEvent:this.originalEvent}))},_getOffsetTop:function(){if(this.$watchOn[0]===b)return this.$el.offset().top;var a=this.el,c=0;do c+=a.offsetTop,a=a.offsetParent;while(a&&a!==this.$watchOn[0]);return c},isInViewport:function(a){var b=this.$watchOn.scrollTop(),c=this.$watchOn.height(),d=b+c,e=this._getOffsetTop(),f=this.el.offsetHeight,g=e+f;a&&(b-=c,d+=c);var h=f>=c;return h&&b>=e&&g>=d?1:!h&&e>=b&&d>=g?1:e>b&&d>e&&g>d?(d-e)/f:g>b&&d>g?(b-g)/f:0}},b.ScrollWatch=f,a.fn.scrollWatch=function(c){var d=a(this),e=d.data("scrollWatch");return e||d.data("scrollWatch",e=new b.ScrollWatch(this,c)),e}}(jQuery,window);
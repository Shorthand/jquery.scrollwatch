(function(t,i){"use strict";var s=["fixed","relative","absolute"],n="mousewheel resize",l=t(i),o=function(s,n){_.bindAll(this,"handleScroll","onScroll"),this.$el=t(s),this.el=this.$el[0],this.options=_.defaults(n||{},{watchOn:i}),this.$watchOn=t(this.options.watchOn),this._prepareContainer(),this.inViewport=!1,this.callbacks={scrollin:t.Callbacks(),scrollout:t.Callbacks(),scroll:t.Callbacks()},this.listen()};o.prototype={_prepareContainer:function(){if(this.$watchOn[0]!==i){var t=this.$watchOn.css("position"),n=_.contains(s,t);n||this.$watchOn.css("position","relative")}},listen:function(){this.$watchOn.on("scroll",this.onScroll),l.on(n,this.onScroll)},destroy:function(){this.$watchOn.off("scroll",this.onScroll),l.off(n,this.onScroll),this.$el.data("scrollWatch",null)},on:function(t,i,s,n){return _.isFunction(i)&&(n=s,s=i,i={}),i=_.extend({},this.options,i),s=_.bind(s,n||this.$el),i.delay&&(s=this._createDelayedCallback(t,s,i)),this.callbacks[t].add(s),this.$watchOn.scroll(),this},_createDelayedCallback:function(t,i,s){return function(){var t=arguments;_.delay(function(){i.apply(this,t)},s.delay)}},handleScroll:function(){var t=this.visibility,i=this.isInViewport(),s=this.$watchOn.scrollTop();return this.direction=this.lastOffset?s>this.lastOffset?"down":"up":!1,this.lastOffset=s,this.visibility=i,this.inViewport||1!==i?this.inViewport&&0===i&&(this.inViewport=!1,this.dfd?this.dfd.done(_.bind(this.trigger,this,"scrollout")):this.trigger("scrollout")):(this.inViewport=!0,this.trigger("scrollin")),i!==t&&this.trigger("scroll"),this},onScroll:function(t){this.running||(this.running=!0,this.originalEvent=t,this.handleScroll(),this.running=!1)},trigger:function(t){return"scroll"!==t&&t===this.lastTriggered?!1:(this.lastTriggered=t,this.callbacks[t].fire({direction:this.direction,visibility:this.visibility,originalEvent:t}),void 0)},_getOffsetTop:function(){if(this.$watchOn[0]===i)return this.$el.offset().top;var t=this.el,s=0;do s+=t.offsetTop,t=t.offsetParent;while(t&&t!==this.$watchOn[0]);return s},isInViewport:function(){var t=this.$watchOn.scrollTop(),i=this.$watchOn.height(),s=t+i,n=this._getOffsetTop(),l=this.$el.outerHeight(),o=n+l,r=l>=i;return r&&t>=n&&o>=s?1:!r&&n>t&&s>o?1:n>t&&s>n&&o>s?(s-n)/l:o>t&&s>o?(t-o)/l:0}},i.ScrollWatch=o,t.fn.scrollWatch=function(s){var n=t(this),l=n.data("scrollWatch");return l||n.data("scrollWatch",l=new i.ScrollWatch(this,s)),l}})(jQuery,window);
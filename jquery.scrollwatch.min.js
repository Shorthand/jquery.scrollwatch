(function(i){"use strict";var t=i(window),s=function(t,s){_.bindAll(this,"handleScroll","onScroll"),this.el=t,this.$el=i(t),this.options=_.defaults(s||{}),this.inViewport=!1,this.callbacks={scrollin:i.Callbacks(),scrollout:i.Callbacks(),scroll:i.Callbacks()},this.setupEvents()};s.prototype={setupEvents:function(){t.on("scroll",this.onScroll)},on:function(i,s,l,n){return _.isFunction(s)&&(l=s,n=l,s={}),s=_.extend({},this.options,s),l=_.bind(l,n||this.$el),s.delay&&(l=this._createDelayedCallback(i,l,s)),this.callbacks[i].add(l),t.scroll(),this},_createDelayedCallback:function(i,t,s){return function(){var i=arguments;_.delay(function(){t.apply(null,i)},s.delay)}},handleScroll:function(){if(this.callbacks){var i=this.visibility,s=this.isInViewport(),l=t.scrollTop();return this.direction=this.lastOffset?l>this.lastOffset?"down":"up":!1,this.lastOffset=l,!this.inViewport&&s>.9?(this.inViewport=!0,this.trigger("scrollin")):this.inViewport&&!s&&(this.inViewport=!1,this.dfd?this.dfd.done(_.bind(this.trigger,this,"scrollout")):this.trigger("scrollout")),s!==i&&(this.visibility=s,this.trigger("scroll")),this}},onScroll:function(){this.running||(this.running=!0,this.handleScroll(),this.running=!1)},trigger:function(i){return"scroll"!==i&&i===this.lastTriggered?!1:(this.lastTriggered=i,this.callbacks[i].fire({direction:this.direction,visibility:this.visibility}),void 0)},isInViewport:function(){var i=t.scrollTop(),s=t.height(),l=i+s,n=this.$el.offset().top,r=this.$el.outerHeight(),o=n+r;return r>=s&&i>=n&&o>=l?1:s>r&&n>i&&l>o?1:n>i&&l>n?(l-n)/r:o>i&&l>o?(i-o)/r:0},off:function(){t.off("scroll",this._handleScroll)}},window.ScrollWatch=s,i.fn.scrollWatch=function(t){var l=i(this),n=l.data("scrollWatch");return n||l.data("scrollWatch",n=new s(this,t)),n}})(jQuery);